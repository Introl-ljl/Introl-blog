---
import type { CollectionEntry } from "astro:content";
import path from "node:path";
import { Icon } from "astro-icon/components";
import I18nKey from "../i18n/i18nKey";
import { i18n } from "../i18n/translation";
import { getDir } from "../utils/url-utils";
import ImageWrapper from "./misc/ImageWrapper.astro";
import PostMetadata from "./PostMeta.astro";

interface Props {
	class?: string;
	entry: CollectionEntry<"posts">;
	title: string;
	url: string;
	published: Date;
	updated?: Date;
	tags: string[];
	category: string | null;
	image: string;
	description: string;
	draft: boolean;
	style: string;
}
const {
	entry,
	title,
	url,
	published,
	updated,
	tags,
	category,
	image,
	description,
	style,
} = Astro.props;
const className = Astro.props.class;

const hasCover = image !== undefined && image !== null && image !== "";
// 移除 coverWidth 变量，因为我们不再需要它

const { remarkPluginFrontmatter } = await entry.render();
---
<!-- 修改后的卡片结构：封面图在顶部，内容在下方 -->
<div class:list={["card-base flex flex-col w-full rounded-xl overflow-hidden shadow-md transition-all duration-300 hover:shadow-lg hover:-translate-y-1 bg-[var(--card-bg)]", className]} style={style}>
    <!-- 封面图部分 -->
    {hasCover && (
        <a href={url} aria-label={`Cover image for ${title}`} class="block relative group h-48 md:h-56 overflow-hidden">
            <ImageWrapper 
                src={image} 
                basePath={path.join("content/posts/", getDir(entry.id))} 
                alt={`Cover image for ${title}`}
                class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
            />
            <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent opacity-60 pointer-events-none"></div>
            <div class="absolute bottom-4 left-4 right-4 text-white">
                <h2 class="text-xl font-bold line-clamp-2">{title}</h2>
            </div>
            <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none">
                <Icon name="material-symbols:chevron-right-rounded" class="text-white text-5xl" />
            </div>
        </a>
    )}

    <!-- 内容部分 -->
    <div class="p-5 flex flex-col flex-grow">
        <!-- 如果没有封面图，则显示标题 -->
        {!hasCover && (
            <a href={url} class="transition group w-full block font-bold mb-3 text-2xl text-90 hover:text-[var(--primary)] dark:hover:text-[var(--primary)]">
                {title}
                <Icon class="inline text-[1.5rem] text-[var(--primary)] ml-1 align-middle transition-transform group-hover:translate-x-1" name="material-symbols:chevron-right-rounded" />
            </a>
        )}

        <!-- 描述 -->
        <div class="transition text-75 mb-4 flex-grow">
            <p class="line-clamp-3">
                { description || remarkPluginFrontmatter.excerpt }
            </p>
        </div>

        <!-- 元数据和统计信息 -->
        <div class="mt-auto">
            <!-- metadata -->
            <PostMetadata 
                published={published} 
                updated={updated} 
                tags={tags} 
                category={category} 
                hideTagsForMobile={false} 
                hideUpdateDate={true} 
                class="mb-3 text-sm"
            ></PostMetadata>

            <!-- word count and read time -->
            <div class="text-xs text-black/50 dark:text-white/50 flex gap-3">
                <div>
                    {remarkPluginFrontmatter.words} {i18n(remarkPluginFrontmatter.words === 1 ? I18nKey.wordCount : I18nKey.wordsCount)}
                </div>
                <div>|</div>
                <div>
                    {remarkPluginFrontmatter.minutes} {i18n(remarkPluginFrontmatter.minutes === 1 ? I18nKey.minuteCount : I18nKey.minutesCount)}
                </div>
            </div>
        </div>
    </div>
</div>
<!-- 移除底部的分隔线，因为卡片之间已经有间距了 -->
